<!doctype html>
<html lang="uz">
 <head>
  <meta charset="UTF-8">
  <title>ATM Terminal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    @keyframes blink-caret {
      0%, 50% { opacity: 1; }
      50.01%, 100% { opacity: 0; }
    }
    .caret::after {
      content: "â–Œ";
      display: inline-block;
      margin-left: 2px;
      animation: blink-caret 1s step-start infinite;
    }
    .atm-scroll::-webkit-scrollbar {
      width: 6px;
    }
    .atm-scroll::-webkit-scrollbar-track {
      background: transparent;
    }
    .atm-scroll::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.2);
      border-radius: 9999px;
    }
    .atm-scroll {
      scrollbar-width: thin;
      scrollbar-color: rgba(0,0,0,0.2) transparent;
    }

    /* Cash Dispenser Animation */
    .dispenser-door {
      transition: transform 0.8s ease-in-out;
      transform-origin: bottom;
    }
    .dispenser-door.open {
      transform: translateY(-100%);
    }

    /* Money Animation */
    @keyframes money-insert {
      0% { transform: scale(0.3) rotate(-10deg); opacity: 0; }
      50% { transform: scale(1.1) rotate(5deg); opacity: 1; }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }
    @keyframes money-dispense {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(-120px) scale(1.3); opacity: 0; }
    }
    .money-bill {
      animation: money-insert 0.6s ease-out;
    }
    .money-bill.dispensing {
      animation: money-dispense 1s ease-out forwards;
    }

    /* Card Animation */
    @keyframes card-insert {
      0% { transform: translateX(100px); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }
    .card-inserting {
      animation: card-insert 1s ease-out;
    }

    /* Pulse effect */
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 5px rgba(34, 197, 94, 0.5); }
      50% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.8); }
    }
    .pulse-active {
      animation: pulse-glow 1.5s ease-in-out infinite;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="w-full h-full m-0 p-0">
  <header class="hidden" aria-hidden="true"></header>
  <nav class="hidden" aria-hidden="true"></nav>
  <main class="w-full h-full min-h-full bg-white flex items-center justify-center px-4 py-6">
   <section class="app-wrapper w-full max-w-4xl h-full min-h-full flex items-center justify-center" aria-label="ATM terminal"><!-- ATM Machine -->
    <div class="relative w-full max-w-2xl bg-gradient-to-b from-[#1e5a9e] to-[#1a4d8a] rounded-3xl shadow-2xl p-8 border-8 border-[#0d3a6b]"><!-- Top ATM Label -->
     <div class="absolute -top-12 left-1/2 transform -translate-x-1/2 bg-white px-8 py-3 rounded-lg shadow-lg border-4 border-gray-300">
      <div class="flex items-center gap-4">
       <div class="w-12 h-1 bg-black"></div>
       <h1 id="atmLabel" class="text-3xl font-bold text-black tracking-wider">ATM</h1>
       <div class="w-12 h-1 bg-black"></div>
      </div>
     </div><!-- Main Content Area -->
     <div class="flex gap-6 mt-8"><!-- Left: Screen -->
      <div class="flex-1"><!-- Screen -->
       <div class="bg-gradient-to-b from-[#0a1929] to-[#1a2332] rounded-2xl p-6 border-4 border-[#0d3a6b] shadow-inner min-h-[400px]">
        <div id="screenArea" class="font-mono text-sm text-green-400 space-y-3 atm-scroll overflow-y-auto max-h-[380px]"><!-- Screen content -->
        </div>
       </div><!-- Keypad -->
       <div class="mt-4 bg-[#2a5a8e] rounded-xl p-2 border-4 border-[#0d3a6b]">
        <div class="grid grid-cols-3 gap-1.5"><button data-key-num="1" class="num-key bg-white hover:bg-gray-200 text-black font-bold text-sm py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-gray-300">1</button> <button data-key-num="2" class="num-key bg-white hover:bg-gray-200 text-black font-bold text-sm py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-gray-300">2</button> <button data-key-num="3" class="num-key bg-white hover:bg-gray-200 text-black font-bold text-sm py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-gray-300">3</button> <button data-key-num="4" class="num-key bg-white hover:bg-gray-200 text-black font-bold text-sm py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-gray-300">4</button> <button data-key-num="5" class="num-key bg-white hover:bg-gray-200 text-black font-bold text-sm py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-gray-300">5</button> <button data-key-num="6" class="num-key bg-white hover:bg-gray-200 text-black font-bold text-sm py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-gray-300">6</button> <button data-key-num="7" class="num-key bg-white hover:bg-gray-200 text-black font-bold text-sm py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-gray-300">7</button> <button data-key-num="8" class="num-key bg-white hover:bg-gray-200 text-black font-bold text-sm py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-gray-300">8</button> <button data-key-num="9" class="num-key bg-white hover:bg-gray-200 text-black font-bold text-sm py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-gray-300">9</button> <button class="bg-red-500 hover:bg-red-600 text-white font-bold text-xs py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-red-700">CANCEL</button> <button data-key-num="0" class="num-key bg-white hover:bg-gray-200 text-black font-bold text-sm py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-gray-300">0</button> <button id="keyClear" class="bg-yellow-500 hover:bg-yellow-600 text-black font-bold text-xs py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-yellow-700">CLEAR</button> <button id="btnConfirm" class="col-span-3 bg-green-500 hover:bg-green-600 text-white font-bold text-sm py-2 rounded shadow-md active:shadow-inner transition-all border-2 border-green-700">ENTER</button>
        </div>
       </div><!-- Bottom Cash Dispenser -->
       <div id="cashDispenserArea" class="mt-4 bg-[#0d3a6b] rounded-xl p-4 border-4 border-[#082847] shadow-inner relative h-28"><!-- Black area for money (stays in background) -->
        <div id="dispenserInnerArea" class="hidden absolute inset-0 bg-black rounded-lg border-2 border-green-600 cursor-pointer hover:bg-gray-900 transition-all">
         <div id="moneyContainer" class="absolute inset-0 flex flex-wrap items-center justify-center gap-2 p-2 overflow-hidden"></div>
        </div><!-- Dispenser Door (moves up, in front) -->
        <div id="dispenserDoor" class="dispenser-door absolute inset-0 bg-gradient-to-b from-gray-800 to-black rounded-lg border-2 border-gray-700 flex items-center justify-center z-10">
         <div id="dispenserLabel" class="text-gray-500 text-sm font-bold">
          CASH DISPENSER
         </div>
        </div>
       </div>
      </div><!-- Right: Card Slot & Info -->
      <div class="w-32 flex flex-col gap-4"><!-- Card Slot -->
       <div id="cardSlotArea" class="bg-[#0d3a6b] rounded-lg p-4 border-4 border-[#082847] shadow-inner cursor-pointer hover:bg-[#0f4270] transition-all">
        <div class="bg-black h-3 rounded mb-2"></div>
        <div class="text-white text-xs text-center font-bold">
         CARD
        </div>
        <div id="cardSlotInner" class="bg-gradient-to-b from-gray-800 to-black h-16 rounded-lg mt-2 border-2 border-gray-700 shadow-inner relative overflow-hidden"><!-- Card will be inserted here -->
        </div>
       </div><!-- Balance Display -->
       <div class="bg-[#0d3a6b] rounded-lg p-2 border-4 border-[#082847]">
        <div class="text-white text-xs font-bold mb-1">
         BALANCE
        </div>
        <div id="balanceDisplay" class="bg-black text-green-400 text-xs font-mono p-2 rounded text-center">
         ****
        </div>
       </div><!-- Status -->
       <div class="bg-[#0d3a6b] rounded-lg p-2 border-4 border-[#082847]">
        <div class="text-white text-xs font-bold mb-1">
         STATUS
        </div>
        <div id="sessionStatus" class="bg-black text-yellow-400 text-xs font-mono p-2 rounded text-center">
         GUEST
        </div>
       </div>
      </div>
     </div><!-- Bottom Controls -->
     <div class="mt-4 flex gap-3 justify-center"><button id="btnHome" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md transition-all border-2 border-blue-800"> HOME </button> <button id="btnBack" class="px-6 py-2 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg shadow-md transition-all border-2 border-gray-800"> BACK </button> <button id="btnExit" class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg shadow-md transition-all border-2 border-red-800"> EXIT </button>
     </div>
    </div>
   </section>
  </main>
  <script>
    const defaultConfig = {
      atm_label: "ATM",
      font_family: "Courier New",
      font_size: 14
    };

    const LANGS = {
      uz: {
        name: "O'zbek",
        screenTitle: "BANKOMAT",
        chooseLang: "Tilni tanlang:",
        cardPrompt: "ðŸ’³ 16 xonali karta raqamini kiriting:",
        pinPrompt: "ðŸ” 4 xonali PIN-kodni kiriting:",
        cardError: "â— Iltimos, 16 ta raqam kiriting.",
        pinError: "â— Iltimos, 4 ta raqam kiriting.",
        loginSuccess: "âœ” Muvaffaqiyatli tizimga kirdingiz!",
        mainMenuTitle: "===== ASOSIY MENYU =====",
        menuItems: [
          "1) Hisobni to'ldirish",
          "2) Naqd pul yechish",
          "3) Pul almashtirish",
          "4) Bog'lanish",
          "5) Chiqish"
        ],
        menuPrompt: "Tanlovingizni tanlang:",
        topUpInsert: "ðŸ’¸ Pullarni dispenser ichiga joylang",
        topUpClick: "ðŸ‘† Dispenser ichiga bosing (har biri 100,000 so'm)",
        topUpDone: "âœ… Tayyor! Tugmani bosing",
        topUpComplete: "ðŸ’° Pul hisobingizga tushdi!",
        withdrawPrompt: "Yechmoqchi bo'lgan summani kiriting (UZS):",
        withdrawDispensing: "ðŸ’µ Pul chiqarilmoqda...",
        withdrawSuccess: "ðŸ’µ Pulni oling!",
        withdrawFail: "âŒ Hisobda yetarli mablag' yo'q!",
        fxPromptAmount: "Almashtirmoqchi bo'lgan summani kiriting:",
        fxInsertMoney: "ðŸ’¸ Pulni dispenser ichiga joylang",
        fxProcessing: "â³ Pul almashtirilmoqda...",
        fxDispensing: "ðŸ’µ Yangi pul chiqarilmoqda...",
        fxMenuTitle: "Valyuta yo'nalishini tanlang:",
        fx1: "1) USD â†’ UZS",
        fx2: "2) UZS â†’ USD",
        fxRateUsdToUzs: "USD â†’ UZS kursini kiriting:",
        fxRateUzsToUsd: "UZS â†’ USD kursini kiriting:",
        fxNotEnough: "âŒ Mablag' yetarli emas!",
        fxDone: "âœ” Pul almashtirildi!",
        contactTitle: "Bog'lanish ma'lumotlari:",
        contactPhone: "ï¿½ï¿½ï¿½ Telefon: +998 90 123 45 67",
        contactEmail: "ðŸ“§ Email: support@bankomat.uz",
        exitAsk: "Chiqasizmi?",
        exitYes: "â–¶ Dastur boshidan ishga tushmoqda...",
        exitNo: "â†© Chiqish bekor qilindi.",
        exitYesLabel: "Ha",
        exitNoLabel: "Yo'q",
        cardInsertPrompt: "ðŸ‘† CARD joyiga bosing va kartani kiriting"
      },
      en: {
        name: "English",
        screenTitle: "ATM",
        chooseLang: "Choose language:",
        cardPrompt: "ðŸ’³ Enter 16-digit card number:",
        pinPrompt: "ðŸ” Enter 4-digit PIN code:",
        cardError: "â— Please enter exactly 16 digits.",
        pinError: "â— Please enter exactly 4 digits.",
        loginSuccess: "âœ” Login successful!",
        mainMenuTitle: "===== MAIN MENU =====",
        menuItems: [
          "1) Deposit",
          "2) Withdraw cash",
          "3) Currency exchange",
          "4) Contact",
          "5) Exit"
        ],
        menuPrompt: "Select an option:",
        topUpInsert: "ðŸ’¸ Insert cash into dispenser",
        topUpClick: "ðŸ‘† Click inside dispenser (100,000 each)",
        topUpDone: "âœ… Ready! Press button",
        topUpComplete: "ðŸ’° Cash credited!",
        withdrawPrompt: "Enter amount to withdraw (UZS):",
        withdrawDispensing: "ðŸ’µ Dispensing cash...",
        withdrawSuccess: "ðŸ’µ Take your cash!",
        withdrawFail: "âŒ Insufficient funds!",
        fxPromptAmount: "Enter amount to exchange:",
        fxInsertMoney: "ðŸ’¸ Insert cash into dispenser",
        fxProcessing: "â³ Exchanging currency...",
        fxDispensing: "ðŸ’µ Dispensing new currency...",
        fxMenuTitle: "Choose direction:",
        fx1: "1) USD â†’ UZS",
        fx2: "2) UZS â†’ USD",
        fxRateUsdToUzs: "Enter USD â†’ UZS rate:",
        fxRateUzsToUsd: "Enter UZS â†’ USD rate:",
        fxNotEnough: "âŒ Not enough funds!",
        fxDone: "âœ” Currency exchanged!",
        contactTitle: "Contact details:",
        contactPhone: "â˜Ž Phone: +998 90 123 45 67",
        contactEmail: "ðŸ“§ Email: support@bankomat.uz",
        exitAsk: "Exit?",
        exitYes: "â–¶ Restarting...",
        exitNo: "â†© Exit cancelled.",
        exitYesLabel: "Yes",
        exitNoLabel: "No",
        cardInsertPrompt: "ðŸ‘† Click CARD slot to insert card"
      },
      ru: {
        name: "Ð ÑƒÑÑÐºÐ¸Ð¹",
        screenTitle: "Ð‘ÐÐÐšÐžÐœÐÐ¢",
        chooseLang: "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ·Ñ‹ï¿½ï¿½:",
        cardPrompt: "ðŸ’³ Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð¾Ð¼ÐµÑ€ ÐºÐ°Ñ€Ñ‚Ñ‹ (16 Ñ†Ð¸Ñ„Ñ€):",
        pinPrompt: "ðŸ” Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ PIN-ÐºÐ¾Ð´ (4 Ñ†Ð¸Ñ„Ñ€Ñ‹):",
        cardError: "â— Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ€Ð¾Ð²Ð½Ð¾ 16 Ñ†Ð¸Ñ„Ñ€.",
        pinError: "â— Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ€Ð¾Ð²Ð½Ð¾ 4 Ñ†Ð¸Ñ„Ñ€Ñ‹.",
        loginSuccess: "âœ” Ð£ÑÐ¿ÐµÑˆÐ½Ñ‹Ð¹ Ð²Ñ…Ð¾Ð´!",
        mainMenuTitle: "===== Ð“Ð›ÐÐ’ÐÐžÐ• Ðœï¿½ï¿½ÐÐ® =====",
        menuItems: [
          "1) ÐŸÐ¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ ÑÑ‡Ñ‘Ñ‚",
          "2) Ð¡Ð½ÑÑ‚ÑŒ Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ",
          "3) ÐžÐ±Ð¼ÐµÐ½ Ð²Ð°Ð»ÑŽÑ‚Ñ‹",
          "4) Ð¡Ð²ÑÐ·Ð°Ñ‚ÑŒÑÑ",
          "5) Ð’Ñ‹Ñ…Ð¾Ð´"
        ],
        menuPrompt: "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ:",
        topUpInsert: "ðŸ’¸ Ð’ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð´ÐµÐ½ÑŒÐ³Ð¸ Ð² Ð´Ð¸ÑÐ¿ÐµÐ½ÑÐµÑ€",
        topUpClick: "ðŸ‘† ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð´Ð¸ÑÐ¿ÐµÐ½ÑÐµÑ€ï¿½ï¿½ï¿½ï¿½ (Ð¿Ð¾ 100,000)",
        topUpDone: "âœ… Ð“Ð¾Ñ‚Ð¾Ð²Ð¾! ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ",
        topUpComplete: "ðŸ’° Ð¡Ñ€ÐµÐ´ÑÑ‚Ð²Ð° Ð·Ð°Ñ‡Ð¸Ñï¿½ï¿½ï¿½ï¿½Ð½Ñ‹!",
        withdrawPrompt: "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÑƒÐ¼Ð¼Ñƒ (UZS):",
        withdrawDispensing: "ðŸ’µ Ð’Ñ‹Ð´Ð°Ñ‡Ð° Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ñ…...",
        withdrawSuccess: "ðŸ’µ Ð—Ð°Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ½ÑŒÐ³Ð¸!",
        withdrawFail: "âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½ï¿½ï¿½ ÑÑ€ÐµÐ´ÑÑ‚Ð²!",
        fxPromptAmount: "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÑÑƒÐ¼Ð¼Ñƒ:",
        fxInsertMoney: "ðŸ’¸ Ð’ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ð´ÐµÐ½ÑŒÐ³Ð¸ Ð² Ð´Ð¸ÑÐ¿ÐµÐ½ÑÐµÑ€",
        fxProcessing: "â³ ÐžÐ±Ð¼ÐµÐ½ Ð²Ð°Ð»ÑŽÑ‚Ñ‹...",
        fxDispensing: "ðŸ’µ Ð’Ñ‹Ð´Ð°Ñ‡Ð° Ð½Ð¾Ð²Ð¾Ð¹ Ð²Ð°Ð»ÑŽÑ‚Ñ‹...",
        fxMenuTitle: "Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ:",
        fx1: "1) USD â†’ UZS",
        fx2: "2) UZS â†’ USD",
        fxRateUsdToUzs: "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÑƒÑ€Ñ USD â†’ UZS:",
        fxRateUzsToUsd: "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ ÐºÑƒÑ€Ñ UZS â†’ USD:",
        fxNotEnough: "âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð²!",
        fxDone: "âœ” ÐžÐ±Ð¼ÐµÐ½ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ðµï¿½ï¿½!",
        contactTitle: "ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹:",
        contactPhone: "â˜Ž Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½: +998 90 123 45 67",
        contactEmail: "ðŸ“§ Email: support@bankomat.uz",
        exitAsk: "Ð’Ñ‹Ð¹Ñ‚Ð¸?",
        exitYes: "â–¶ ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº...",
        exitNo: "â†© Ð’Ñ‹Ñ…Ð¾Ð´ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‘Ð½.",
        exitYesLabel: "Ð”Ð°",
        exitNoLabel: "ÐÐµÑ‚",
        cardInsertPrompt: "ðŸ‘† ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° ÑÐ»Ð¾Ñ‚ CARD Ð´Ð»Ñ Ð²ÑÑ‚Ð°Ð²ÐºÐ¸ ÐºÐ°Ñ€Ñ‚Ñ‹"
      }
    };

    const SCREENS = {
      LANGUAGE: "language",
      LOGIN_CARD: "login_card",
      LOGIN_PIN: "login_pin",
      MENU: "menu",
      TOPUP: "topup",
      TOPUP_INSERTING: "topup_inserting",
      WITHDRAW: "withdraw",
      WITHDRAW_DISPENSING: "withdraw_dispensing",
      FX_DIRECTION: "fx_direction",
      FX_AMOUNT: "fx_amount",
      FX_INSERTING: "fx_inserting",
      FX_RATE: "fx_rate",
      FX_PROCESSING: "fx_processing",
      CONTACT: "contact",
      EXIT_CONFIRM: "exit_confirm",
      EXITING: "exiting"
    };

    let currentLang = "uz";
    let currentScreen = SCREENS.LANGUAGE;
    let balance = 0;
    let cardNumber = "";
    let pinCode = "";
    let fxDirection = null;
    let fxAmount = 0;
    let fxRate = 0;
    let topUpTimer = null;
    let activeInputId = null;
    let dispenserOpen = false;
    let tempDepositAmount = 0;
    let cardInserted = false;

    const screenArea = document.getElementById("screenArea");
    const sessionStatus = document.getElementById("sessionStatus");
    const btnHome = document.getElementById("btnHome");
    const btnBack = document.getElementById("btnBack");
    const btnConfirm = document.getElementById("btnConfirm");
    const btnExit = document.getElementById("btnExit");
    const balanceDisplay = document.getElementById("balanceDisplay");
    const atmLabel = document.getElementById("atmLabel");
    const numKeys = document.querySelectorAll(".num-key");
    const keyClear = document.getElementById("keyClear");
    const dispenserDoor = document.getElementById("dispenserDoor");
    const cashDispenserArea = document.getElementById("cashDispenserArea");
    const moneyContainer = document.getElementById("moneyContainer");
    const dispenserInnerArea = document.getElementById("dispenserInnerArea");
    const dispenserLabel = document.getElementById("dispenserLabel");
    const cardSlotArea = document.getElementById("cardSlotArea");
    const cardSlotInner = document.getElementById("cardSlotInner");

    function t(key) {
      return LANGS[currentLang][key];
    }

    function formatCurrency(amount) {
      return new Intl.NumberFormat("uz-UZ").format(Math.round(amount));
    }

    function updateBalanceDisplay() {
      if (currentScreen === SCREENS.LANGUAGE || currentScreen === SCREENS.LOGIN_CARD) {
        balanceDisplay.textContent = "****";
      } else {
        balanceDisplay.textContent = `${formatCurrency(balance)} UZS`;
      }
    }

    function setSessionLoggedIn() {
      sessionStatus.textContent = "USER";
      sessionStatus.className = "bg-black text-green-400 text-xs font-mono p-2 rounded text-center";
    }

    function setSessionGuest() {
      sessionStatus.textContent = "GUEST";
      sessionStatus.className = "bg-black text-yellow-400 text-xs font-mono p-2 rounded text-center";
    }

    function clearTimers() {
      if (topUpTimer) {
        clearInterval(topUpTimer);
        topUpTimer = null;
      }
    }

    function setActiveInput(id) {
      activeInputId = id;
    }

    function getActiveInputElement() {
      if (!activeInputId) return null;
      return document.getElementById(activeInputId);
    }

    function openDispenser() {
      if (dispenserOpen) return;
      dispenserOpen = true;
      dispenserDoor.classList.add("open");
      cashDispenserArea.classList.add("pulse-active");
      
      // Show black inner area and hide label
      setTimeout(() => {
        dispenserLabel.classList.add("hidden");
        dispenserInnerArea.classList.remove("hidden");
      }, 800);
    }

    function closeDispenser() {
      if (!dispenserOpen) return;
      dispenserOpen = false;
      
      // Hide inner area and show label
      dispenserInnerArea.classList.add("hidden");
      dispenserLabel.classList.remove("hidden");
      
      setTimeout(() => {
        dispenserDoor.classList.remove("open");
        cashDispenserArea.classList.remove("pulse-active");
        moneyContainer.innerHTML = "";
      }, 500);
    }

    function insertMoneyBill() {
      const bill = document.createElement("div");
      bill.className = "money-bill w-20 h-10 bg-gradient-to-r from-green-600 to-green-500 rounded border-2 border-green-700 flex items-center justify-center text-white text-sm font-bold shadow-lg";
      bill.textContent = "ðŸ’µ 100K";
      bill.style.pointerEvents = "none";
      moneyContainer.appendChild(bill);
    }

    function dispenseMoney(count = 1) {
      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          const bill = document.createElement("div");
          bill.className = "money-bill dispensing absolute w-20 h-10 bg-gradient-to-r from-green-600 to-green-500 rounded border-2 border-green-700 flex items-center justify-center text-white text-sm font-bold shadow-lg";
          bill.textContent = "ðŸ’µ";
          bill.style.pointerEvents = "none";
          bill.style.left = `${Math.random() * 60}%`;
          bill.style.top = `${Math.random() * 40 + 30}%`;
          moneyContainer.appendChild(bill);
          
          setTimeout(() => {
            bill.remove();
          }, 1000);
        }, i * 300);
      }
    }

    function insertCard() {
      if (cardInserted) return;
      cardInserted = true;
      
      const card = document.createElement("div");
      card.className = "card-inserting absolute inset-0 bg-gradient-to-r from-yellow-600 via-yellow-500 to-yellow-600 rounded border-2 border-yellow-700 flex items-center justify-center text-white text-xs font-bold";
      card.textContent = "ðŸ’³";
      cardSlotInner.appendChild(card);
      
      cardSlotArea.classList.remove("pulse-active");
      
      setTimeout(() => {
        if (currentScreen === SCREENS.LANGUAGE) {
          renderCardScreen();
        }
      }, 1000);
    }

    function ejectCard() {
      cardInserted = false;
      cardSlotInner.innerHTML = "";
    }

    // Card slot click handler
    cardSlotArea.addEventListener("click", () => {
      if (currentScreen === SCREENS.LANGUAGE && !cardInserted) {
        insertCard();
      }
    });

    function renderLanguageScreen() {
      currentScreen = SCREENS.LANGUAGE;
      clearTimers();
      closeDispenser();
      ejectCard();
      setSessionGuest();
      cardNumber = "";
      pinCode = "";
      balance = 0;
      fxDirection = null;
      fxAmount = 0;
      fxRate = 0;
      tempDepositAmount = 0;
      activeInputId = null;
      updateBalanceDisplay();

      screenArea.innerHTML = "";

      const title = document.createElement("div");
      title.className = "text-center text-xl text-green-400 font-bold mb-4";
      title.textContent = "=========================";

      const subtitle = document.createElement("div");
      subtitle.className = "text-center text-lg text-green-400 font-bold mb-2";
      subtitle.textContent = "BANKOMAT / ATM / Ð‘ÐÐÐšÐžÐœÐÐ¢";

      const title2 = document.createElement("div");
      title2.className = "text-center text-xl text-green-400 font-bold mb-4";
      title2.textContent = "=========================";

      const cardPrompt = document.createElement("p");
      cardPrompt.className = "text-center text-yellow-300 mb-4 animate-pulse";
      cardPrompt.textContent = "ðŸ‘† CARD joyiga bosing";

      const prompt = document.createElement("p");
      prompt.className = "text-center text-green-300 mb-4";
      prompt.textContent = "Tilni tanlang / Choose language / Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ·Ñ‹Ðº";

      const btnRow = document.createElement("div");
      btnRow.className = "flex flex-col gap-2";

      ["uz", "en", "ru"].forEach((code) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "px-4 py-2 bg-green-600 hover:bg-green-500 text-white font-bold rounded transition-all";
        btn.textContent = LANGS[code].name;
        btn.addEventListener("click", () => {
          currentLang = code;
          if (cardInserted) {
            renderCardScreen();
          } else {
            cardSlotArea.classList.add("pulse-active");
            screenArea.innerHTML = `<p class="text-yellow-300 text-center animate-pulse">${t("cardInsertPrompt")}</p>`;
          }
        });
        btnRow.appendChild(btn);
      });

      screenArea.appendChild(title);
      screenArea.appendChild(subtitle);
      screenArea.appendChild(title2);
      screenArea.appendChild(cardPrompt);
      screenArea.appendChild(prompt);
      screenArea.appendChild(btnRow);

      cardSlotArea.classList.add("pulse-active");
    }

    function renderCardScreen(errorMsg) {
      currentScreen = SCREENS.LOGIN_CARD;
      clearTimers();
      closeDispenser();
      screenArea.innerHTML = "";

      const pinLabel = document.createElement("label");
      pinLabel.setAttribute("for", "pinInput");
      pinLabel.className = "block text-green-300 mb-2";
      pinLabel.textContent = t("pinPrompt");

      const pinInput = document.createElement("input");
      pinInput.id = "pinInput";
      pinInput.type = "password";
      pinInput.maxLength = 4;
      pinInput.className = "w-full bg-black border-2 border-green-600 rounded px-3 py-2 text-green-400 font-mono focus:outline-none focus:border-green-400";
      pinInput.value = pinCode;
      pinInput.addEventListener("focus", () => setActiveInput("pinInput"));
      pinInput.addEventListener("input", () => {
        pinInput.value = pinInput.value.replace(/\D/g, "");
      });

      const error = document.createElement("p");
      error.className = "text-xs text-red-400 mt-2 min-h-[1rem]";
      error.textContent = errorMsg || "";

      const success = document.createElement("p");
      success.className = "mt-4 text-green-300 text-sm min-h-[1.25rem]";
      success.textContent = "";

      screenArea.appendChild(pinLabel);
      screenArea.appendChild(pinInput);
      screenArea.appendChild(error);
      screenArea.appendChild(success);

      setActiveInput("pinInput");
      btnConfirm.onclick = handleCardConfirm;
      btnBack.onclick = () => renderLanguageScreen();
    }



    function renderMenuScreen() {
      currentScreen = SCREENS.MENU;
      clearTimers();
      closeDispenser();
      screenArea.innerHTML = "";

      const title = document.createElement("div");
      title.className = "text-green-400 font-bold mb-3";
      title.textContent = t("mainMenuTitle");

      const list = document.createElement("ul");
      list.className = "space-y-2 text-green-300";
      t("menuItems").forEach((item, index) => {
        const li = document.createElement("li");
        li.textContent = item;
        li.className = "cursor-pointer hover:text-green-100 hover:translate-x-1 transition-all py-1";
        li.addEventListener("click", () => {
          handleMenuChoice(index + 1);
        });
        list.appendChild(li);
      });

      const prompt = document.createElement("p");
      prompt.className = "mt-4 text-green-300 caret";
      prompt.textContent = t("menuPrompt");

      screenArea.appendChild(title);
      screenArea.appendChild(list);
      screenArea.appendChild(prompt);

      setSessionLoggedIn();
      btnConfirm.onclick = () => {};
      btnBack.onclick = () => renderLanguageScreen();
    }

    function renderTopUpScreen() {
      currentScreen = SCREENS.TOPUP;
      clearTimers();
      tempDepositAmount = 0;
      screenArea.innerHTML = "";

      const msg1 = document.createElement("p");
      msg1.className = "text-green-300 mb-3 text-center text-lg";
      msg1.textContent = t("topUpInsert");

      const msg2 = document.createElement("p");
      msg2.className = "text-yellow-300 mb-2 text-center animate-pulse";
      msg2.textContent = t("topUpClick");

      const amountDisplay = document.createElement("p");
      amountDisplay.id = "depositAmount";
      amountDisplay.className = "text-green-400 text-xl font-bold text-center my-4";
      amountDisplay.textContent = `${formatCurrency(tempDepositAmount)} UZS`;

      const doneBtn = document.createElement("button");
      doneBtn.type = "button";
      doneBtn.className = "w-full px-4 py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg mt-4 transition-all";
      doneBtn.textContent = t("topUpDone");
      doneBtn.addEventListener("click", () => {
        handleTopUpComplete();
      });

      screenArea.appendChild(msg1);
      screenArea.appendChild(msg2);
      screenArea.appendChild(amountDisplay);
      screenArea.appendChild(doneBtn);

      openDispenser();

      // Make dispenser inner area clickable
      const clickHandler = () => {
        if (currentScreen === SCREENS.TOPUP) {
          tempDepositAmount += 100000;
          const amountEl = document.getElementById("depositAmount");
          if (amountEl) {
            amountEl.textContent = `${formatCurrency(tempDepositAmount)} UZS`;
          }
          insertMoneyBill();
        }
      };
      
      dispenserInnerArea.onclick = clickHandler;

      btnConfirm.onclick = () => handleTopUpComplete();
      btnBack.onclick = () => {
        closeDispenser();
        dispenserInnerArea.onclick = null;
        renderMenuScreen();
      };
    }

    function handleTopUpComplete() {
      if (tempDepositAmount === 0) {
        renderMenuScreen();
        return;
      }

      currentScreen = SCREENS.TOPUP_INSERTING;
      dispenserInnerArea.onclick = null;
      
      screenArea.innerHTML = `<p class="text-green-400 text-center text-lg">${t("topUpComplete")}</p>`;
      
      balance += tempDepositAmount;
      updateBalanceDisplay();
      
      setTimeout(() => {
        closeDispenser();
        
        setTimeout(() => {
          renderMenuScreen();
        }, 1500);
      }, 1000);
    }

    function renderWithdrawScreen(errorMsg) {
      currentScreen = SCREENS.WITHDRAW;
      clearTimers();
      closeDispenser();
      screenArea.innerHTML = "";

      const label = document.createElement("label");
      label.setAttribute("for", "withdrawInput");
      label.className = "block text-green-300 mb-2";
      label.textContent = t("withdrawPrompt");

      const input = document.createElement("input");
      input.id = "withdrawInput";
      input.type = "text";
      input.inputMode = "numeric";
      input.className = "w-full bg-black border-2 border-green-600 rounded px-3 py-2 text-green-400 font-mono focus:outline-none focus:border-green-400";
      input.addEventListener("focus", () => setActiveInput("withdrawInput"));
      input.addEventListener("input", () => {
        input.value = input.value.replace(/\D/g, "");
      });

      const error = document.createElement("p");
      error.className = "text-xs text-red-400 mt-2 min-h-[1rem]";
      error.textContent = errorMsg || "";

      screenArea.appendChild(label);
      screenArea.appendChild(input);
      screenArea.appendChild(error);

      setActiveInput("withdrawInput");
      btnConfirm.onclick = handleWithdrawConfirm;
      btnBack.onclick = () => renderMenuScreen();
    }

    function renderWithdrawDispensing(amount) {
      currentScreen = SCREENS.WITHDRAW_DISPENSING;
      screenArea.innerHTML = "";

      const msg = document.createElement("p");
      msg.className = "text-yellow-300 text-center text-lg animate-pulse";
      msg.textContent = t("withdrawDispensing");

      const amountDisplay = document.createElement("p");
      amountDisplay.className = "text-green-400 text-xl font-bold text-center my-4";
      amountDisplay.textContent = `${formatCurrency(amount)} UZS`;

      screenArea.appendChild(msg);
      screenArea.appendChild(amountDisplay);

      openDispenser();
      
      setTimeout(() => {
        const billCount = Math.min(Math.ceil(amount / 100000), 10);
        dispenseMoney(billCount);
        
        screenArea.innerHTML = `<p class="text-green-400 text-center text-lg">${t("withdrawSuccess")}</p>`;
        
        setTimeout(() => {
          closeDispenser();
          setTimeout(() => {
            renderMenuScreen();
          }, 1000);
        }, 3000);
      }, 1500);

      btnConfirm.disabled = true;
      btnBack.onclick = null;
    }

    function renderFxDirectionScreen() {
      currentScreen = SCREENS.FX_DIRECTION;
      clearTimers();
      closeDispenser();
      screenArea.innerHTML = "";

      const amountLabel = document.createElement("label");
      amountLabel.setAttribute("for", "fxAmountInput");
      amountLabel.className = "block text-green-300 mb-2";
      amountLabel.textContent = t("fxPromptAmount");

      const amountInput = document.createElement("input");
      amountInput.id = "fxAmountInput";
      amountInput.type = "text";
      amountInput.inputMode = "numeric";
      amountInput.className = "w-full bg-black border-2 border-green-600 rounded px-3 py-2 text-green-400 font-mono focus:outline-none focus:border-green-400";
      amountInput.addEventListener("focus", () => setActiveInput("fxAmountInput"));
      amountInput.addEventListener("input", () => {
        amountInput.value = amountInput.value.replace(/\D/g, "");
      });

      const menuTitle = document.createElement("p");
      menuTitle.className = "mt-4 text-green-300";
      menuTitle.textContent = t("fxMenuTitle");

      const list = document.createElement("ul");
      list.className = "mt-1 space-y-1 text-green-300";
      [t("fx1"), t("fx2")].forEach((txt, index) => {
        const li = document.createElement("li");
        li.textContent = txt;
        li.className = "cursor-pointer hover:text-green-100";
        li.addEventListener("click", () => {
          fxDirection = index === 0 ? "USD_TO_UZS" : "UZS_TO_USD";
          handleFxAmountConfirm();
        });
        list.appendChild(li);
      });

      screenArea.appendChild(amountLabel);
      screenArea.appendChild(amountInput);
      screenArea.appendChild(menuTitle);
      screenArea.appendChild(list);

      setActiveInput("fxAmountInput");
      btnConfirm.onclick = handleFxAmountConfirm;
      btnBack.onclick = () => renderMenuScreen();
    }

    function renderFxInsertingScreen() {
      currentScreen = SCREENS.FX_INSERTING;
      tempDepositAmount = 0;
      screenArea.innerHTML = "";

      const msg1 = document.createElement("p");
      msg1.className = "text-green-300 mb-3 text-center text-lg";
      msg1.textContent = t("fxInsertMoney");

      const msg2 = document.createElement("p");
      msg2.className = "text-yellow-300 mb-2 text-center animate-pulse";
      msg2.textContent = t("topUpClick");

      const amountDisplay = document.createElement("p");
      amountDisplay.id = "fxDepositAmount";
      amountDisplay.className = "text-green-400 text-xl font-bold text-center my-4";
      amountDisplay.textContent = `${formatCurrency(tempDepositAmount)} / ${formatCurrency(fxAmount)} UZS`;

      const doneBtn = document.createElement("button");
      doneBtn.type = "button";
      doneBtn.className = "w-full px-4 py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg mt-4 transition-all";
      doneBtn.textContent = t("topUpDone");
      doneBtn.addEventListener("click", () => {
        if (tempDepositAmount >= fxAmount) {
          handleFxInsertComplete();
        }
      });

      screenArea.appendChild(msg1);
      screenArea.appendChild(msg2);
      screenArea.appendChild(amountDisplay);
      screenArea.appendChild(doneBtn);

      openDispenser();

      const clickHandler = () => {
        if (currentScreen === SCREENS.FX_INSERTING) {
          tempDepositAmount += 100000;
          const amountEl = document.getElementById("fxDepositAmount");
          if (amountEl) {
            amountEl.textContent = `${formatCurrency(tempDepositAmount)} / ${formatCurrency(fxAmount)} UZS`;
          }
          insertMoneyBill();
        }
      };
      
      dispenserInnerArea.onclick = clickHandler;

      btnConfirm.onclick = () => {
        if (tempDepositAmount >= fxAmount) {
          handleFxInsertComplete();
        }
      };
      btnBack.onclick = () => {
        closeDispenser();
        dispenserInnerArea.onclick = null;
        renderFxDirectionScreen();
      };
    }

    function handleFxInsertComplete() {
      dispenserInnerArea.onclick = null;
      closeDispenser();
      
      setTimeout(() => {
        renderFxRateScreen();
      }, 1500);
    }

    function renderFxRateScreen() {
      currentScreen = SCREENS.FX_RATE;
      clearTimers();
      screenArea.innerHTML = "";

      const amountInfo = document.createElement("p");
      amountInfo.className = "text-green-300 mb-3";
      amountInfo.textContent = `Amount: ${formatCurrency(fxAmount)} UZS`;

      const rateLabel = document.createElement("label");
      rateLabel.setAttribute("for", "fxRateInput");
      rateLabel.className = "block text-green-300 mb-2";
      rateLabel.textContent = fxDirection === "USD_TO_UZS" ? t("fxRateUsdToUzs") : t("fxRateUzsToUsd");

      const rateInput = document.createElement("input");
      rateInput.id = "fxRateInput";
      rateInput.type = "text";
      rateInput.inputMode = "numeric";
      rateInput.className = "w-full bg-black border-2 border-green-600 rounded px-3 py-2 text-green-400 font-mono focus:outline-none focus:border-green-400";
      rateInput.addEventListener("focus", () => setActiveInput("fxRateInput"));
      rateInput.addEventListener("input", () => {
        rateInput.value = rateInput.value.replace(/[^0-9.]/g, "");
      });

      screenArea.appendChild(amountInfo);
      screenArea.appendChild(rateLabel);
      screenArea.appendChild(rateInput);

      setActiveInput("fxRateInput");
      btnConfirm.onclick = handleFxRateConfirm;
      btnBack.onclick = () => renderFxDirectionScreen();
    }

    function renderFxProcessing() {
      currentScreen = SCREENS.FX_PROCESSING;
      screenArea.innerHTML = "";

      const msg = document.createElement("p");
      msg.className = "text-yellow-300 text-center text-lg animate-pulse";
      msg.textContent = t("fxProcessing");

      screenArea.appendChild(msg);

      btnConfirm.disabled = true;
      btnBack.onclick = null;

      setTimeout(() => {
        screenArea.innerHTML = `<p class="text-yellow-300 text-center text-lg animate-pulse">${t("fxDispensing")}</p>`;
        
        openDispenser();
        
        setTimeout(() => {
          const billCount = Math.min(Math.ceil(fxAmount / 100000), 10);
          dispenseMoney(billCount);
          
          if (fxDirection === "USD_TO_UZS") {
            balance += fxAmount * fxRate;
          } else {
            balance += fxAmount / fxRate;
          }
          updateBalanceDisplay();
          
          screenArea.innerHTML = `<p class="text-green-400 text-center text-lg">${t("fxDone")}</p>`;
          
          setTimeout(() => {
            closeDispenser();
            btnConfirm.disabled = false;
            setTimeout(() => {
              renderMenuScreen();
            }, 1000);
          }, 3000);
        }, 1500);
      }, 30000); // 30 seconds processing
    }

    function renderContactScreen() {
      currentScreen = SCREENS.CONTACT;
      clearTimers();
      closeDispenser();
      screenArea.innerHTML = "";

      const title = document.createElement("p");
      title.className = "text-green-400 mb-2 font-bold";
      title.textContent = t("contactTitle");

      const p1 = document.createElement("p");
      p1.className = "text-green-300";
      p1.textContent = t("contactPhone");

      const p2 = document.createElement("p");
      p2.className = "text-green-300 mt-1";
      p2.textContent = t("contactEmail");

      screenArea.appendChild(title);
      screenArea.appendChild(p1);
      screenArea.appendChild(p2);

      btnConfirm.onclick = () => renderMenuScreen();
      btnBack.onclick = () => renderMenuScreen();
    }

    function renderExitConfirmScreen() {
      currentScreen = SCREENS.EXIT_CONFIRM;
      clearTimers();
      closeDispenser();
      screenArea.innerHTML = "";

      const question = document.createElement("p");
      question.className = "text-green-300 mb-3";
      question.textContent = t("exitAsk");

      const buttons = document.createElement("div");
      buttons.className = "flex gap-2 mt-2";

      const yesBtn = document.createElement("button");
      yesBtn.type = "button";
      yesBtn.className = "px-4 py-2 bg-green-600 hover:bg-green-500 text-white font-bold rounded";
      yesBtn.textContent = t("exitYesLabel");
      yesBtn.addEventListener("click", () => {
        renderExitingScreen();
      });

      const noBtn = document.createElement("button");
      noBtn.type = "button";
      noBtn.className = "px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white font-bold rounded";
      noBtn.textContent = t("exitNoLabel");
      noBtn.addEventListener("click", () => {
        renderMenuScreen();
      });

      buttons.appendChild(yesBtn);
      buttons.appendChild(noBtn);

      screenArea.appendChild(question);
      screenArea.appendChild(buttons);

      btnConfirm.onclick = () => {};
      btnBack.onclick = () => renderMenuScreen();
    }

    function renderExitingScreen() {
      currentScreen = SCREENS.EXITING;
      clearTimers();
      closeDispenser();
      screenArea.innerHTML = "";

      const msg = document.createElement("p");
      msg.className = "text-green-400";
      msg.textContent = t("exitYes");

      screenArea.appendChild(msg);
      setSessionGuest();

      setTimeout(() => {
        renderLanguageScreen();
      }, 1200);
    }

    function handleCardConfirm() {
      const input = document.getElementById("pinInput");
      const value = (input.value || "").replace(/\D/g, "");
      if (value.length !== 4) {
        renderCardScreen(t("pinError"));
        return;
      }
      pinCode = value;
      // Generate random balance between 500,000 and 5,000,000
      balance = Math.floor(Math.random() * (5000000 - 500000 + 1)) + 500000;
      updateBalanceDisplay();
      setTimeout(() => {
        renderMenuScreen();
      }, 800);
    }

    function handlePinConfirm() {
      const input = document.getElementById("pinInput");
      const value = (input.value || "").replace(/\D/g, "");
      if (value.length !== 4) {
        renderPinScreen(t("pinError"));
        return;
      }
      pinCode = value;
      setTimeout(() => {
        renderMenuScreen();
      }, 800);
    }

    function handleMenuChoice(num) {
      switch (num) {
        case 1: renderTopUpScreen(); break;
        case 2: renderWithdrawScreen(); break;
        case 3: renderFxDirectionScreen(); break;
        case 4: renderContactScreen(); break;
        case 5: renderExitConfirmScreen(); break;
      }
    }

    function handleWithdrawConfirm() {
      const input = document.getElementById("withdrawInput");
      const value = parseInt((input.value || "").replace(/\D/g, ""), 10);
      if (!value || value <= 0 || value > balance) {
        renderWithdrawScreen(t("withdrawFail"));
        return;
      }
      balance -= value;
      updateBalanceDisplay();
      renderWithdrawDispensing(value);
    }

    function handleFxAmountConfirm() {
      const input = document.getElementById("fxAmountInput");
      const value = parseFloat((input.value || "").replace(/[^\d.]/g, ""));
      if (!value || value <= 0) {
        renderFxDirectionScreen();
        return;
      }
      fxAmount = value;
      if (!fxDirection) fxDirection = "USD_TO_UZS";
      renderFxInsertingScreen();
    }

    function handleFxRateConfirm() {
      const input = document.getElementById("fxRateInput");
      const rate = parseFloat((input.value || "").replace(/[^\d.]/g, ""));
      if (!rate || rate <= 0) {
        screenArea.innerHTML = `<p class="text-red-400">${t("fxNotEnough")}</p>`;
        return;
      }
      fxRate = rate;
      renderFxProcessing();
    }

    numKeys.forEach((btn) => {
      btn.addEventListener("click", () => {
        const digit = btn.getAttribute("data-key-num");
        const active = getActiveInputElement();
        if (!active) return;
        active.value = (active.value || "") + digit;
        active.dispatchEvent(new Event("input", { bubbles: true }));
      });
    });

    keyClear.addEventListener("click", () => {
      const active = getActiveInputElement();
      if (!active) return;
      active.value = "";
      active.dispatchEvent(new Event("input", { bubbles: true }));
    });

    btnHome.addEventListener("click", () => renderLanguageScreen());
    btnExit.addEventListener("click", () => {
      if (currentScreen === SCREENS.LANGUAGE || currentScreen === SCREENS.LOGIN_CARD) {
        renderLanguageScreen();
      } else {
        renderExitConfirmScreen();
      }
    });

    function applyBaseFont() {
      const baseSize = defaultConfig.font_size;
      const customFont = defaultConfig.font_family;
      const fontStack = `${customFont}, monospace`;
      document.documentElement.style.fontSize = baseSize + "px";
      document.body.style.fontFamily = fontStack;
    }

    applyBaseFont();
    updateBalanceDisplay();
    renderLanguageScreen();

    if (window.elementSdk && typeof window.elementSdk.init === "function") {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          const baseSize = config.font_size || defaultConfig.font_size;
          const customFont = config.font_family || defaultConfig.font_family;
          const fontStack = `${customFont}, monospace`;
          document.documentElement.style.fontSize = baseSize + "px";
          document.body.style.fontFamily = fontStack;
          atmLabel.textContent = config.atm_label || defaultConfig.atm_label;
        },
        mapToCapabilities: (config) => {
          return {
            recolorables: [],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                if (!window.elementSdk) return;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                if (!window.elementSdk) return;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          };
        },
        mapToEditPanelValues: (config) => {
          return new Map([
            ["atm_label", config.atm_label || defaultConfig.atm_label]
          ]);
        }
      });
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a73773547e13ccd',t:'MTc2NDYwMTM0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>